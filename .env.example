# ==============================================
# Call Me Back - Environment Variables
# ==============================================
# Copy this file to .env and fill in your actual values
# DO NOT commit .env to version control!

# ==============================================
# SERVER CONFIGURATION
# ==============================================
NODE_ENV=development
PORT=3001
BASE_URL=

# ==============================================
# JWT AUTHENTICATION
# ==============================================
# Generate with: node -e "console.log(require('crypto').randomBytes(32).toString('hex'))"
JWT_SECRET=your-super-secret-random-string-min-32-chars
JWT_EXPIRATION=30d

# ==============================================
# RAINDROP PLATFORM (Managed automatically)
# ==============================================
# These are provided by Raindrop - no manual config needed
# RAINDROP_API_KEY=auto-configured
# RAINDROP_PROJECT_ID=auto-configured

# ==============================================
# DATABASE (SmartSQL - Managed by Raindrop)
# ==============================================
# Raindrop manages this automatically
# DATABASE_URL=auto-configured

# ==============================================
# TWILIO (Phone Calls & SMS)
# ==============================================
# Get from: https://console.twilio.com/
TWILIO_ACCOUNT_SID=ACxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx
TWILIO_AUTH_TOKEN=your-twilio-auth-token
TWILIO_PHONE_NUMBER=+15551234567

# Webhook URLs (auto-configured based on BASE_URL)
# TWILIO_CALLBACK_URL=${BASE_URL}/api/twilio/callback
# TWILIO_ANSWER_URL=${BASE_URL}/api/twilio/answer
# TWILIO_STREAM_URL=${BASE_URL}/api/twilio/stream

# ==============================================
# ELEVENLABS (Text-to-Speech)
# ==============================================
# Get from: https://elevenlabs.io/app/settings/api-keys
ELEVENLABS_API_KEY=your-elevenlabs-api-key

# Voice IDs (pre-configured, can override)
ELEVENLABS_VOICE_RACHEL=EXAVITQu4vr4xnSDxMaL
ELEVENLABS_VOICE_ADAM=pNInz6obpgDQGcFmaJgB
ELEVENLABS_VOICE_BELLA=EXAVITQu4vr4xnSDxMaL
ELEVENLABS_VOICE_EMILY=LcfcDJNUP1GQjkzn1xUU
ELEVENLABS_VOICE_GRACE=oWAxZDx7w5VEj9dCyTzz

# Model settings
ELEVENLABS_MODEL=eleven_turbo_v2
ELEVENLABS_OPTIMIZE_STREAMING=4

# Cost tracking (cents per 1000 characters)

# ==============================================
# CEREBRAS (AI Inference - Primary)
# ==============================================
# Get from: https://cloud.cerebras.ai/
CEREBRAS_API_KEY=your-cerebras-api-key
CEREBRAS_API_URL=https://api.cerebras.ai/v1/chat/completions
CEREBRAS_MODEL=llama3.1-8b

# Performance settings
CEREBRAS_MAX_TOKENS=150
CEREBRAS_TEMPERATURE=0.7
CEREBRAS_STREAM=true

# Cost tracking (cents per 1M tokens)

# ==============================================
# OPENAI (AI Inference - Fallback)
# ==============================================
# Get from: https://platform.openai.com/api-keys
OPENAI_API_KEY=sk-proj-xxxxxxxxxxxxxxxxxxxxxxxx
OPENAI_MODEL=gpt-4-turbo-preview
OPENAI_MAX_TOKENS=150
OPENAI_TEMPERATURE=0.7

# Cost tracking (cents per 1M tokens)

# Realtime API (for voice)
OPENAI_REALTIME_MODEL=gpt-4-realtime-preview

# ==============================================
# STRIPE (Payments)
# ==============================================
# Get from: https://dashboard.stripe.com/apikeys
STRIPE_SECRET_KEY=sk_test_xxxxxxxxxxxxxxxxxxxxxxxx
STRIPE_PUBLISHABLE_KEY=pk_test_xxxxxxxxxxxxxxxxxxxxxxxx
STRIPE_WEBHOOK_SECRET=whsec_xxxxxxxxxxxxxxxxxxxxxxxx

# Pricing configuration (in cents)
STRIPE_CURRENCY=usd

# ==============================================
# SPEECH-TO-TEXT (Choose one)
# ==============================================

# Option 1: Deepgram (Recommended)
DEEPGRAM_API_KEY=your-deepgram-api-key
DEEPGRAM_MODEL=nova-2
DEEPGRAM_LANGUAGE=en-US
# Cost tracking (cents per minute)

# Option 2: AssemblyAI
# ASSEMBLYAI_API_KEY=your-assemblyai-api-key

# Option 3: OpenAI Whisper
# Uses OPENAI_API_KEY above
# WHISPER_MODEL=whisper-1

# Active STT provider
STT_PROVIDER=deepgram

# ==============================================
# COST TRACKING & BILLING
# ==============================================

# Cost calculation precision
COST_PRECISION_DECIMALS=4

# Warning thresholds (in cents)
COST_WARNING_PER_CALL=500
COST_WARNING_DAILY_USER=2000
COST_WARNING_MONTHLY_USER=5000

# Auto-cutoff limits (in cents)
COST_CUTOFF_PER_CALL=1000
COST_CUTOFF_DAILY_USER=5000
COST_CUTOFF_MONTHLY_USER=10000

# Billing cycle
BILLING_CYCLE_START_DAY=1

# Cost breakdown logging
ENABLE_DETAILED_COST_LOGGING=true
COST_LOG_LEVEL=info

# ==============================================
# MEMORY MANAGEMENT
# ==============================================

# SmartMemory tier settings
MEMORY_WORKING_TTL_HOURS=1
MEMORY_SHORT_TERM_DAYS=30
MEMORY_SHORT_TERM_MAX_CALLS=10
MEMORY_LONG_TERM_EXPIRY=never

# Context window budgets (in tokens)
MEMORY_MAX_TOKENS_CORE_PROMPT=500
MEMORY_MAX_TOKENS_RELATIONSHIP=300
MEMORY_MAX_TOKENS_LONG_TERM=1000
MEMORY_MAX_TOKENS_SHORT_TERM=500
MEMORY_MAX_TOKENS_WORKING=2000
MEMORY_TOTAL_BUDGET=4300

# Memory extraction (AI-powered)
MEMORY_EXTRACTOR_MODEL=cerebras
MEMORY_EXTRACTION_ENABLED=true
MEMORY_AUTO_SUMMARIZE=true

# User memory preferences
MEMORY_USER_CONTROL_ENABLED=true
MEMORY_ALLOW_DELETION=true
MEMORY_ALLOW_EDITING=true

# ==============================================
# RATE LIMITING
# ==============================================

# Per-endpoint rate limits (requests per minute)
RATE_LIMIT_AUTH_LOGIN=5
RATE_LIMIT_AUTH_REGISTER=3
RATE_LIMIT_CALLS_TRIGGER=5
RATE_LIMIT_CALLS_LIST=60
RATE_LIMIT_PERSONAS_CREATE=20
RATE_LIMIT_PERSONAS_LIST=60

# Global limits
RATE_LIMIT_GLOBAL_PER_IP=100
RATE_LIMIT_GLOBAL_PER_USER=200

# ==============================================
# SECURITY
# ==============================================

# Password requirements
PASSWORD_MIN_LENGTH=8
PASSWORD_REQUIRE_UPPERCASE=true
PASSWORD_REQUIRE_LOWERCASE=true
PASSWORD_REQUIRE_NUMBER=true
PASSWORD_REQUIRE_SPECIAL=true

# Bcrypt cost factor (higher = more secure but slower)
BCRYPT_ROUNDS=12

# Account lockout
ACCOUNT_LOCKOUT_ATTEMPTS=10
ACCOUNT_LOCKOUT_DURATION_MINUTES=30

# CORS
CORS_ALLOWED_ORIGINS=http://localhost:5173,http://localhost:3000
CORS_ALLOWED_METHODS=GET,POST,PUT,DELETE,OPTIONS
CORS_ALLOWED_HEADERS=Content-Type,Authorization

# Request limits
REQUEST_MAX_SIZE_MB=1
REQUEST_TIMEOUT_SECONDS=30

# ==============================================
# LOGGING & MONITORING
# ==============================================

# Log levels: error, warn, info, debug, trace
LOG_LEVEL=info
LOG_FORMAT=json
LOG_INCLUDE_TIMESTAMP=true

# Sensitive data masking
LOG_MASK_PHONE_NUMBERS=true
LOG_MASK_EMAILS=false
LOG_MASK_TOKENS=true

# Error tracking (optional)
# SENTRY_DSN=https://xxxxx@sentry.io/xxxxx
# SENTRY_ENVIRONMENT=development

# ==============================================
# PERFORMANCE & SCALING
# ==============================================

# Response time targets (milliseconds)
TARGET_AI_RESPONSE_MS=1000
TARGET_TTS_RESPONSE_MS=2000
TARGET_TOTAL_RESPONSE_MS=3000

# Connection pooling
DB_POOL_MIN=2
DB_POOL_MAX=10

# Cache TTL (seconds)
CACHE_PERSONAS_TTL=300
CACHE_USER_PROFILE_TTL=60
CACHE_CALL_HISTORY_TTL=30

# WebSocket settings
WS_HEARTBEAT_INTERVAL=30000
WS_MAX_CONNECTIONS_PER_USER=3

# ==============================================
# FEATURE FLAGS
# ==============================================

# Enable/disable features
FEATURE_SCHEDULED_CALLS=true
FEATURE_CUSTOM_PERSONAS=true
FEATURE_VOICE_CLONING=false
FEATURE_GROUP_CALLS=false
FEATURE_SMS_FALLBACK=false

# Beta features (for testing)
FEATURE_BETA_MEMORY_EDITOR=true
FEATURE_BETA_COST_DASHBOARD=true
FEATURE_BETA_PERSONA_MARKETPLACE=false

# ==============================================
# DEVELOPMENT & TESTING
# ==============================================

# Mock mode (for testing without real API calls)
MOCK_TWILIO=false
MOCK_ELEVENLABS=false
MOCK_CEREBRAS=false
MOCK_STRIPE=false

# Test phone numbers (Twilio verified)
TEST_PHONE_NUMBERS=+15551234567,+15559876543

# Bypass auth for testing
DEV_BYPASS_AUTH=false
DEV_BYPASS_RATE_LIMITS=false

# Seed data
DEV_SEED_SYSTEM_PERSONAS=true
DEV_SEED_TEST_USERS=false

# ==============================================
# ANALYTICS & METRICS
# ==============================================

# Enable analytics
ENABLE_ANALYTICS=true
ANALYTICS_PROVIDER=internal

# Metrics to track
TRACK_CALL_SUCCESS_RATE=true
TRACK_AI_RESPONSE_TIME=true
TRACK_USER_SATISFACTION=true
TRACK_COST_PER_CALL=true

# Aggregation windows
METRICS_AGGREGATION_INTERVAL_MINUTES=5
METRICS_RETENTION_DAYS=90

# ==============================================
# NOTIFICATIONS
# ==============================================

# Email notifications (optional)
# SMTP_HOST=smtp.gmail.com
# SMTP_PORT=587
# SMTP_USER=noreply@callmeback.app
# SMTP_PASS=your-smtp-password
# EMAIL_FROM=Call Me Back <noreply@callmeback.app>

# Notification triggers
NOTIFY_ON_HIGH_COST=true
NOTIFY_ON_CALL_FAILURE=true
NOTIFY_ON_PAYMENT_FAILURE=true

# Admin contacts
ADMIN_EMAIL=admin@callmeback.app
ADMIN_PHONE=+15551234567

# ==============================================
# WEBHOOKS
# ==============================================

# Twilio webhook signature verification
TWILIO_VERIFY_WEBHOOK_SIGNATURE=true

# Stripe webhook signature verification
STRIPE_VERIFY_WEBHOOK_SIGNATURE=true

# Webhook timeout
WEBHOOK_TIMEOUT_MS=5000

# ==============================================
# SCHEDULED JOBS & CRON
# ==============================================

# Scheduled call processing
SCHEDULED_CALLS_CHECK_INTERVAL_MINUTES=5
SCHEDULED_CALLS_LEAD_TIME_MINUTES=2

# Cleanup jobs
CLEANUP_OLD_TRANSCRIPTS_DAYS=365
CLEANUP_EXPIRED_TOKENS_HOURS=24
CLEANUP_FAILED_CALLS_DAYS=7

# ==============================================
# TIMEZONE
# ==============================================
TZ=UTC

# ==============================================
# NOTES
# ==============================================
# 1. All costs are in cents (USD) unless otherwise noted
# 2. Token counts are approximate - actual usage may vary
# 3. Memory token budgets should total less than model max context
# 4. Rate limits are per minute unless otherwise noted
# 5. For production, set NODE_ENV=production
# 6. Always use HTTPS in production (BASE_URL should be https://)
# 7. Keep JWT_SECRET secure and rotate periodically
# 8. Webhook secrets should match Twilio/Stripe dashboard settings
# 9. Test all integrations in sandbox mode before going live
# 10. Monitor costs closely - AI/TTS usage can add up quickly!
